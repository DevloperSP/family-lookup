<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Lookup</title>
  <link rel="stylesheet" href="style.css"> <!-- optional -->
</head>
<body>
  <h1>Family Lookup</h1>
  <input type="text" id="familyId" placeholder="Enter Family ID">
  <button onclick="searchFamily()">Search</button>
  <div id="output"></div>

  <script>
    async function searchFamily() {
        const familyId = document.getElementById('familyId').value.trim();
        const output = document.getElementById('output');

        if (!/^\d{5,20}$/.test(familyId)) {
            output.innerHTML = '<div class="error-card">Invalid ID format</div>';
            return;
        }

        output.innerHTML = '<div>Fetching family records...</div>';

        try {
            const res = await fetch(`/.netlify/functions/family?q=${familyId}&i=2`);
            const data = await res.json();

            if (!data.memberDetailsList) {
                output.innerHTML = '<div class="error-card">No family records found</div>';
                return;
            }

            let html = `<h2>Ration Card: ${data.rcId}</h2>`;
            data.memberDetailsList.forEach((m, i) => {
                html += `<p>${i+1}. ${m.memberName} (${m.releationship_name}) - UID: ${m.uid}</p>`;
            });

            output.innerHTML = html;

        } catch (err) {
            output.innerHTML = `<div class="error-card">${err.message}</div>`;
        }
    }
  </script>
</body>
</html>
